test_run = require('test_run').new()
---
...
engine = test_run:get_cfg('engine')
---
...
test_run:cmd("push filter '"..engine.."' to 'engine'")
---
- true
...
--------------------------------------------------------------------------------
-- Prefix search (test partially specified keys in TREE indexes)
--------------------------------------------------------------------------------
s1 = box.schema.space.create('tree_prefix_search', { engine = engine })
---
...
_ = s1:create_index('primary', { type = 'tree', parts = {1, 'str'}})
---
...
_ = s1:replace{''}
---
...
_ = s1:replace{'abcd'}
---
...
_ = s1:replace{'abcda'}
---
...
_ = s1:replace{'abcda_'}
---
...
_ = s1:replace{'abcdb'}
---
...
_ = s1:replace{'abcdb_'}
---
...
_ = s1:replace{'abcdb__'}
---
...
_ = s1:replace{'abcdb___'}
---
...
_ = s1:replace{'abcdc'}
---
...
_ = s1:replace{'abcdc_'}
---
...
s1.index.primary:select('abcdb', { iterator = 'GE' })
---
- - ['abcdb']
  - ['abcdb_']
  - ['abcdb__']
  - ['abcdb___']
  - ['abcdc']
  - ['abcdc_']
...
s1.index.primary:select('', { iterator = 'GE' })
---
- - ['']
  - ['abcd']
  - ['abcda']
  - ['abcda_']
  - ['abcdb']
  - ['abcdb_']
  - ['abcdb__']
  - ['abcdb___']
  - ['abcdc']
  - ['abcdc_']
...
s1.index.primary:select('', { iterator = 'GT' })
---
- - ['abcd']
  - ['abcda']
  - ['abcda_']
  - ['abcdb']
  - ['abcdb_']
  - ['abcdb__']
  - ['abcdb___']
  - ['abcdc']
  - ['abcdc_']
...
s1.index.primary:select('', { iterator = 'LE' })
---
- - ['']
...
s1.index.primary:select('', { iterator = 'LT' })
---
- []
...
s1:drop()
---
...
s1 = nil
---
...
-------------------------------------------------------------------------------
-- single-part (unsigned)
-------------------------------------------------------------------------------
space = box.schema.space.create('uint', { engine = engine })
---
...
pk = space:create_index('primary', { type = 'tree', parts = {1, 'num'}})
---
...
for i=1,9 do space:replace{i} end
---
...
pk:select({}, { iterator = 'ALL' })
---
- - [1]
  - [2]
  - [3]
  - [4]
  - [5]
  - [6]
  - [7]
  - [8]
  - [9]
...
pk:select({}, { iterator = 'EQ' })
---
- - [1]
  - [2]
  - [3]
  - [4]
  - [5]
  - [6]
  - [7]
  - [8]
  - [9]
...
pk:select({}, { iterator = 'REQ' })
---
- - [9]
  - [8]
  - [7]
  - [6]
  - [5]
  - [4]
  - [3]
  - [2]
  - [1]
...
pk:select({}, { iterator = 'GE' })
---
- - [1]
  - [2]
  - [3]
  - [4]
  - [5]
  - [6]
  - [7]
  - [8]
  - [9]
...
pk:select({}, { iterator = 'GT' })
---
- - [1]
  - [2]
  - [3]
  - [4]
  - [5]
  - [6]
  - [7]
  - [8]
  - [9]
...
pk:select({}, { iterator = 'LE' })
---
- - [9]
  - [8]
  - [7]
  - [6]
  - [5]
  - [4]
  - [3]
  - [2]
  - [1]
...
pk:select({}, { iterator = 'LT' })
---
- - [9]
  - [8]
  - [7]
  - [6]
  - [5]
  - [4]
  - [3]
  - [2]
  - [1]
...
pk:select({0}, { iterator = 'EQ' })
---
- []
...
pk:select({0}, { iterator = 'REQ' })
---
- []
...
pk:select({0}, { iterator = 'LE' })
---
- []
...
pk:select({0}, { iterator = 'LT' })
---
- []
...
pk:select({1}, { iterator = 'EQ' })
---
- - [1]
...
pk:select({1}, { iterator = 'REQ' })
---
- - [1]
...
pk:select({1}, { iterator = 'LE' })
---
- - [1]
...
pk:select({1}, { iterator = 'LT' })
---
- []
...
pk:select({5}, { iterator = 'EQ' })
---
- - [5]
...
pk:select({5}, { iterator = 'REQ' })
---
- - [5]
...
pk:select({5}, { iterator = 'GE' })
---
- - [5]
  - [6]
  - [7]
  - [8]
  - [9]
...
pk:select({5}, { iterator = 'GT' })
---
- - [6]
  - [7]
  - [8]
  - [9]
...
pk:select({5}, { iterator = 'LE' })
---
- - [5]
  - [4]
  - [3]
  - [2]
  - [1]
...
pk:select({5}, { iterator = 'LT' })
---
- - [4]
  - [3]
  - [2]
  - [1]
...
pk:select({9}, { iterator = 'EQ' })
---
- - [9]
...
pk:select({9}, { iterator = 'REQ' })
---
- - [9]
...
pk:select({9}, { iterator = 'GE' })
---
- - [9]
...
pk:select({9}, { iterator = 'GT' })
---
- []
...
pk:select({10}, { iterator = 'EQ' })
---
- []
...
pk:select({10}, { iterator = 'REQ' })
---
- []
...
pk:select({10}, { iterator = 'GE' })
---
- []
...
pk:select({10}, { iterator = 'GT' })
---
- []
...
pk:get({})
---
- error: Invalid key part count in an exact match (expected 1, got 0)
...
pk:get({0})
---
...
pk:get({5})
---
- [5]
...
pk:get({10})
---
...
pk:get({10, 15})
---
- error: Invalid key part count in an exact match (expected 1, got 2)
...
space:drop()
---
...
space = nil
---
...
pk = nil
---
...
-------------------------------------------------------------------------------
-- single-part (string)
-------------------------------------------------------------------------------
space = box.schema.space.create('str', { engine = engine })
---
...
pk = space:create_index('primary', { type = 'tree', parts = {1, 'str'}})
---
...
for i=1,9 do space:replace{'0'..i} end
---
...
pk:select({}, { iterator = 'ALL' })
---
- - ['01']
  - ['02']
  - ['03']
  - ['04']
  - ['05']
  - ['06']
  - ['07']
  - ['08']
  - ['09']
...
pk:select({}, { iterator = 'EQ' })
---
- - ['01']
  - ['02']
  - ['03']
  - ['04']
  - ['05']
  - ['06']
  - ['07']
  - ['08']
  - ['09']
...
pk:select({}, { iterator = 'REQ' })
---
- - ['09']
  - ['08']
  - ['07']
  - ['06']
  - ['05']
  - ['04']
  - ['03']
  - ['02']
  - ['01']
...
pk:select({}, { iterator = 'GE' })
---
- - ['01']
  - ['02']
  - ['03']
  - ['04']
  - ['05']
  - ['06']
  - ['07']
  - ['08']
  - ['09']
...
pk:select({}, { iterator = 'GT' })
---
- - ['01']
  - ['02']
  - ['03']
  - ['04']
  - ['05']
  - ['06']
  - ['07']
  - ['08']
  - ['09']
...
pk:select({}, { iterator = 'LE' })
---
- - ['09']
  - ['08']
  - ['07']
  - ['06']
  - ['05']
  - ['04']
  - ['03']
  - ['02']
  - ['01']
...
pk:select({}, { iterator = 'LT' })
---
- - ['09']
  - ['08']
  - ['07']
  - ['06']
  - ['05']
  - ['04']
  - ['03']
  - ['02']
  - ['01']
...
pk:select({'00'}, { iterator = 'EQ' })
---
- []
...
pk:select({'00'}, { iterator = 'REQ' })
---
- []
...
pk:select({'00'}, { iterator = 'LE' })
---
- []
...
pk:select({'00'}, { iterator = 'LT' })
---
- []
...
pk:select({'01'}, { iterator = 'EQ' })
---
- - ['01']
...
pk:select({'01'}, { iterator = 'REQ' })
---
- - ['01']
...
pk:select({'01'}, { iterator = 'LE' })
---
- - ['01']
...
pk:select({'01'}, { iterator = 'LT' })
---
- []
...
pk:select({'05'}, { iterator = 'EQ' })
---
- - ['05']
...
pk:select({'05'}, { iterator = 'REQ' })
---
- - ['05']
...
pk:select({'05'}, { iterator = 'GE' })
---
- - ['05']
  - ['06']
  - ['07']
  - ['08']
  - ['09']
...
pk:select({'05'}, { iterator = 'GT' })
---
- - ['06']
  - ['07']
  - ['08']
  - ['09']
...
pk:select({'05'}, { iterator = 'LE' })
---
- - ['05']
  - ['04']
  - ['03']
  - ['02']
  - ['01']
...
pk:select({'05'}, { iterator = 'LT' })
---
- - ['04']
  - ['03']
  - ['02']
  - ['01']
...
pk:select({'09'}, { iterator = 'EQ' })
---
- - ['09']
...
pk:select({'09'}, { iterator = 'REQ' })
---
- - ['09']
...
pk:select({'09'}, { iterator = 'GE' })
---
- - ['09']
...
pk:select({'09'}, { iterator = 'GT' })
---
- []
...
pk:select({'10'}, { iterator = 'EQ' })
---
- []
...
pk:select({'10'}, { iterator = 'REQ' })
---
- []
...
pk:select({'10'}, { iterator = 'GE' })
---
- []
...
pk:select({'10'}, { iterator = 'GT' })
---
- []
...
pk:get({})
---
- error: Invalid key part count in an exact match (expected 1, got 0)
...
pk:get({'0'})
---
...
pk:get({'5'})
---
...
pk:get({'10'})
---
...
pk:get({'10', '15'})
---
- error: Invalid key part count in an exact match (expected 1, got 2)
...
space:drop()
---
...
space = nil
---
...
pk = nil
---
...
-------------------------------------------------------------------------------
-- multi-part (unsigned + string)
-------------------------------------------------------------------------------
space = box.schema.space.create('uint_str', { engine = engine })
---
...
pk = space:create_index('primary', { type = 'tree', parts = {1, 'num', 2, 'str'}})
---
...
for i=1,9 do for j=1,3 do space:replace({i, '0'..j}) end end
---
...
--
-- one part
--
pk:select({}, { iterator = 'ALL' })
---
- - [1, '01']
  - [1, '02']
  - [1, '03']
  - [2, '01']
  - [2, '02']
  - [2, '03']
  - [3, '01']
  - [3, '02']
  - [3, '03']
  - [4, '01']
  - [4, '02']
  - [4, '03']
  - [5, '01']
  - [5, '02']
  - [5, '03']
  - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({}, { iterator = 'EQ' })
---
- - [1, '01']
  - [1, '02']
  - [1, '03']
  - [2, '01']
  - [2, '02']
  - [2, '03']
  - [3, '01']
  - [3, '02']
  - [3, '03']
  - [4, '01']
  - [4, '02']
  - [4, '03']
  - [5, '01']
  - [5, '02']
  - [5, '03']
  - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({}, { iterator = 'REQ' })
---
- - [9, '03']
  - [9, '02']
  - [9, '01']
  - [8, '03']
  - [8, '02']
  - [8, '01']
  - [7, '03']
  - [7, '02']
  - [7, '01']
  - [6, '03']
  - [6, '02']
  - [6, '01']
  - [5, '03']
  - [5, '02']
  - [5, '01']
  - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({}, { iterator = 'GE' })
---
- - [1, '01']
  - [1, '02']
  - [1, '03']
  - [2, '01']
  - [2, '02']
  - [2, '03']
  - [3, '01']
  - [3, '02']
  - [3, '03']
  - [4, '01']
  - [4, '02']
  - [4, '03']
  - [5, '01']
  - [5, '02']
  - [5, '03']
  - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({}, { iterator = 'GT' })
---
- - [1, '01']
  - [1, '02']
  - [1, '03']
  - [2, '01']
  - [2, '02']
  - [2, '03']
  - [3, '01']
  - [3, '02']
  - [3, '03']
  - [4, '01']
  - [4, '02']
  - [4, '03']
  - [5, '01']
  - [5, '02']
  - [5, '03']
  - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({}, { iterator = 'LE' })
---
- - [9, '03']
  - [9, '02']
  - [9, '01']
  - [8, '03']
  - [8, '02']
  - [8, '01']
  - [7, '03']
  - [7, '02']
  - [7, '01']
  - [6, '03']
  - [6, '02']
  - [6, '01']
  - [5, '03']
  - [5, '02']
  - [5, '01']
  - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({}, { iterator = 'LT' })
---
- - [9, '03']
  - [9, '02']
  - [9, '01']
  - [8, '03']
  - [8, '02']
  - [8, '01']
  - [7, '03']
  - [7, '02']
  - [7, '01']
  - [6, '03']
  - [6, '02']
  - [6, '01']
  - [5, '03']
  - [5, '02']
  - [5, '01']
  - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({0}, { iterator = 'EQ' })
---
- []
...
pk:select({0}, { iterator = 'REQ' })
---
- []
...
pk:select({0}, { iterator = 'LE' })
---
- []
...
pk:select({0}, { iterator = 'LT' })
---
- []
...
pk:select({1}, { iterator = 'EQ' })
---
- - [1, '01']
  - [1, '02']
  - [1, '03']
...
pk:select({1}, { iterator = 'REQ' })
---
- - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({1}, { iterator = 'LE' })
---
- - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({1}, { iterator = 'LT' })
---
- []
...
pk:select({9}, { iterator = 'EQ' })
---
- - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({9}, { iterator = 'REQ' })
---
- - [9, '03']
  - [9, '02']
  - [9, '01']
...
pk:select({9}, { iterator = 'GE' })
---
- - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({9}, { iterator = 'GT' })
---
- []
...
pk:select({10}, { iterator = 'EQ' })
---
- []
...
pk:select({10}, { iterator = 'REQ' })
---
- []
...
pk:select({10}, { iterator = 'GE' })
---
- []
...
pk:select({10}, { iterator = 'GT' })
---
- []
...
pk:get({})
---
- error: Invalid key part count in an exact match (expected 2, got 0)
...
pk:get({'5'})
---
- error: Invalid key part count in an exact match (expected 2, got 1)
...
--
-- two parts
--
pk:select({5, '00'}, { iterator = 'EQ' })
---
- []
...
pk:select({5, '00'}, { iterator = 'REQ' })
---
- []
...
pk:select({5, '00'}, { iterator = 'GE' })
---
- - [5, '01']
  - [5, '02']
  - [5, '03']
  - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({5, '00'}, { iterator = 'GT' })
---
- - [5, '01']
  - [5, '02']
  - [5, '03']
  - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({5, '00'}, { iterator = 'LE' })
---
- - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({5, '00'}, { iterator = 'LT' })
---
- - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({5, '01'}, { iterator = 'EQ' })
---
- - [5, '01']
...
pk:select({5, '01'}, { iterator = 'REQ' })
---
- - [5, '01']
...
pk:select({5, '01'}, { iterator = 'GE' })
---
- - [5, '01']
  - [5, '02']
  - [5, '03']
  - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({5, '01'}, { iterator = 'GT' })
---
- - [5, '02']
  - [5, '03']
  - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({5, '01'}, { iterator = 'LE' })
---
- - [5, '01']
  - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({5, '01'}, { iterator = 'LT' })
---
- - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({5, '03'}, { iterator = 'EQ' })
---
- - [5, '03']
...
pk:select({5, '03'}, { iterator = 'REQ' })
---
- - [5, '03']
...
pk:select({5, '03'}, { iterator = 'GE' })
---
- - [5, '03']
  - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({5, '03'}, { iterator = 'GT' })
---
- - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({5, '03'}, { iterator = 'LE' })
---
- - [5, '03']
  - [5, '02']
  - [5, '01']
  - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({5, '03'}, { iterator = 'LT' })
---
- - [5, '02']
  - [5, '01']
  - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({5, '04'}, { iterator = 'EQ' })
---
- []
...
pk:select({5, '04'}, { iterator = 'REQ' })
---
- []
...
pk:select({5, '04'}, { iterator = 'GE' })
---
- - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({5, '04'}, { iterator = 'GT' })
---
- - [6, '01']
  - [6, '02']
  - [6, '03']
  - [7, '01']
  - [7, '02']
  - [7, '03']
  - [8, '01']
  - [8, '02']
  - [8, '03']
  - [9, '01']
  - [9, '02']
  - [9, '03']
...
pk:select({5, '04'}, { iterator = 'LE' })
---
- - [5, '03']
  - [5, '02']
  - [5, '01']
  - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:select({5, '04'}, { iterator = 'LT' })
---
- - [5, '03']
  - [5, '02']
  - [5, '01']
  - [4, '03']
  - [4, '02']
  - [4, '01']
  - [3, '03']
  - [3, '02']
  - [3, '01']
  - [2, '03']
  - [2, '02']
  - [2, '01']
  - [1, '03']
  - [1, '02']
  - [1, '01']
...
pk:get({4, '05'})
---
...
pk:get({4, '03'})
---
- [4, '03']
...
pk:get({4, '03', 100})
---
- error: Invalid key part count in an exact match (expected 2, got 3)
...
space:drop()
---
...
space = nil
---
...
pk = nil
---
...
-------------------------------------------------------------------------------
-- multi-part (string + unsigned)
-------------------------------------------------------------------------------
space = box.schema.space.create('str_uint', { engine = engine })
---
...
pk = space:create_index('primary', { type = 'tree', parts = {1, 'str', 2, 'num'}})
---
...
for i=1,9 do for j=1,3 do space:replace({'0'..i, j}) end end
---
...
--
-- one part
--
pk:select({}, { iterator = 'ALL' })
---
- - ['01', 1]
  - ['01', 2]
  - ['01', 3]
  - ['02', 1]
  - ['02', 2]
  - ['02', 3]
  - ['03', 1]
  - ['03', 2]
  - ['03', 3]
  - ['04', 1]
  - ['04', 2]
  - ['04', 3]
  - ['05', 1]
  - ['05', 2]
  - ['05', 3]
  - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({}, { iterator = 'EQ' })
---
- - ['01', 1]
  - ['01', 2]
  - ['01', 3]
  - ['02', 1]
  - ['02', 2]
  - ['02', 3]
  - ['03', 1]
  - ['03', 2]
  - ['03', 3]
  - ['04', 1]
  - ['04', 2]
  - ['04', 3]
  - ['05', 1]
  - ['05', 2]
  - ['05', 3]
  - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({}, { iterator = 'REQ' })
---
- - ['09', 3]
  - ['09', 2]
  - ['09', 1]
  - ['08', 3]
  - ['08', 2]
  - ['08', 1]
  - ['07', 3]
  - ['07', 2]
  - ['07', 1]
  - ['06', 3]
  - ['06', 2]
  - ['06', 1]
  - ['05', 3]
  - ['05', 2]
  - ['05', 1]
  - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({}, { iterator = 'GE' })
---
- - ['01', 1]
  - ['01', 2]
  - ['01', 3]
  - ['02', 1]
  - ['02', 2]
  - ['02', 3]
  - ['03', 1]
  - ['03', 2]
  - ['03', 3]
  - ['04', 1]
  - ['04', 2]
  - ['04', 3]
  - ['05', 1]
  - ['05', 2]
  - ['05', 3]
  - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({}, { iterator = 'GT' })
---
- - ['01', 1]
  - ['01', 2]
  - ['01', 3]
  - ['02', 1]
  - ['02', 2]
  - ['02', 3]
  - ['03', 1]
  - ['03', 2]
  - ['03', 3]
  - ['04', 1]
  - ['04', 2]
  - ['04', 3]
  - ['05', 1]
  - ['05', 2]
  - ['05', 3]
  - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({}, { iterator = 'LE' })
---
- - ['09', 3]
  - ['09', 2]
  - ['09', 1]
  - ['08', 3]
  - ['08', 2]
  - ['08', 1]
  - ['07', 3]
  - ['07', 2]
  - ['07', 1]
  - ['06', 3]
  - ['06', 2]
  - ['06', 1]
  - ['05', 3]
  - ['05', 2]
  - ['05', 1]
  - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({}, { iterator = 'LT' })
---
- - ['09', 3]
  - ['09', 2]
  - ['09', 1]
  - ['08', 3]
  - ['08', 2]
  - ['08', 1]
  - ['07', 3]
  - ['07', 2]
  - ['07', 1]
  - ['06', 3]
  - ['06', 2]
  - ['06', 1]
  - ['05', 3]
  - ['05', 2]
  - ['05', 1]
  - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({'00'}, { iterator = 'EQ' })
---
- []
...
pk:select({'00'}, { iterator = 'REQ' })
---
- []
...
pk:select({'00'}, { iterator = 'LE' })
---
- []
...
pk:select({'00'}, { iterator = 'LT' })
---
- []
...
pk:select({'01'}, { iterator = 'EQ' })
---
- - ['01', 1]
  - ['01', 2]
  - ['01', 3]
...
pk:select({'01'}, { iterator = 'REQ' })
---
- - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({'01'}, { iterator = 'LE' })
---
- - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({'01'}, { iterator = 'LT' })
---
- []
...
pk:select({'09'}, { iterator = 'EQ' })
---
- - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({'09'}, { iterator = 'REQ' })
---
- - ['09', 3]
  - ['09', 2]
  - ['09', 1]
...
pk:select({'09'}, { iterator = 'GE' })
---
- - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({'09'}, { iterator = 'GT' })
---
- []
...
pk:select({'10'}, { iterator = 'EQ' })
---
- []
...
pk:select({'10'}, { iterator = 'REQ' })
---
- []
...
pk:select({'10'}, { iterator = 'GE' })
---
- []
...
pk:select({'10'}, { iterator = 'GT' })
---
- []
...
pk:get({})
---
- error: Invalid key part count in an exact match (expected 2, got 0)
...
pk:get({'00'})
---
- error: Invalid key part count in an exact match (expected 2, got 1)
...
pk:get({'05'})
---
- error: Invalid key part count in an exact match (expected 2, got 1)
...
pk:get({'10'})
---
- error: Invalid key part count in an exact match (expected 2, got 1)
...
--
-- two parts
--
pk:select({'05', 0}, { iterator = 'EQ' })
---
- []
...
pk:select({'05', 0}, { iterator = 'REQ' })
---
- []
...
pk:select({'05', 0}, { iterator = 'GE' })
---
- - ['05', 1]
  - ['05', 2]
  - ['05', 3]
  - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({'05', 0}, { iterator = 'GT' })
---
- - ['05', 1]
  - ['05', 2]
  - ['05', 3]
  - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({'05', 0}, { iterator = 'LE' })
---
- - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({'05', 0}, { iterator = 'LT' })
---
- - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({'05', 1}, { iterator = 'EQ' })
---
- - ['05', 1]
...
pk:select({'05', 1}, { iterator = 'REQ' })
---
- - ['05', 1]
...
pk:select({'05', 1}, { iterator = 'GE' })
---
- - ['05', 1]
  - ['05', 2]
  - ['05', 3]
  - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({'05', 1}, { iterator = 'GT' })
---
- - ['05', 2]
  - ['05', 3]
  - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({'05', 1}, { iterator = 'LE' })
---
- - ['05', 1]
  - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({'05', 1}, { iterator = 'LT' })
---
- - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({'05', 3}, { iterator = 'EQ' })
---
- - ['05', 3]
...
pk:select({'05', 3}, { iterator = 'REQ' })
---
- - ['05', 3]
...
pk:select({'05', 3}, { iterator = 'GE' })
---
- - ['05', 3]
  - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({'05', 3}, { iterator = 'GT' })
---
- - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({'05', 3}, { iterator = 'LE' })
---
- - ['05', 3]
  - ['05', 2]
  - ['05', 1]
  - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({'05', 3}, { iterator = 'LT' })
---
- - ['05', 2]
  - ['05', 1]
  - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({'05', 4}, { iterator = 'EQ' })
---
- []
...
pk:select({'05', 4}, { iterator = 'REQ' })
---
- []
...
pk:select({'05', 4}, { iterator = 'GE' })
---
- - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({'05', 4}, { iterator = 'GT' })
---
- - ['06', 1]
  - ['06', 2]
  - ['06', 3]
  - ['07', 1]
  - ['07', 2]
  - ['07', 3]
  - ['08', 1]
  - ['08', 2]
  - ['08', 3]
  - ['09', 1]
  - ['09', 2]
  - ['09', 3]
...
pk:select({'05', 4}, { iterator = 'LE' })
---
- - ['05', 3]
  - ['05', 2]
  - ['05', 1]
  - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:select({'05', 4}, { iterator = 'LT' })
---
- - ['05', 3]
  - ['05', 2]
  - ['05', 1]
  - ['04', 3]
  - ['04', 2]
  - ['04', 1]
  - ['03', 3]
  - ['03', 2]
  - ['03', 1]
  - ['02', 3]
  - ['02', 2]
  - ['02', 1]
  - ['01', 3]
  - ['01', 2]
  - ['01', 1]
...
pk:get({'04', 5})
---
...
pk:get({'04', 3})
---
- ['04', 3]
...
pk:get({'04', 3, 100})
---
- error: Invalid key part count in an exact match (expected 2, got 3)
...
space:drop()
---
...
space = nil
---
...
pk = nil
---
...
-------------------------------------------------------------------------------
-- gh-1467: invalid iterator type
-------------------------------------------------------------------------------
space = box.schema.space.create('invalid', { engine = engine })
---
...
pk = space:create_index('primary', { type = 'tree', parts = {1, 'str'}})
---
...
pk:select({}, {iterator = 'BITS_ALL_SET'})
---
- error: Index 'primary' (TREE) of space 'invalid' (engine) does not support requested
    iterator type
...
space:drop()
---
...
space = nil
---
...
pk = nil
---
...
-------------------------------------------------------------------------------
-- Cleanup
-------------------------------------------------------------------------------
test_run:cmd("clear filter")
---
- true
...
engine = nil
---
...
test_run = nil
---
...
